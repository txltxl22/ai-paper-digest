<!-- Modern Article Card Component -->
<article data-id='{{ e.id }}' data-abstract-only='{{ 'true' if e.is_abstract_only else 'false' }}'>
  <!-- Header Section -->
  <div class="article-header">
    <div class="header-left">
      <h2>
        <div class="arxiv-id-container">
          <span class="id-label">arXiv ID:</span>
          <a href='{{ url_for("summary_detail.view_summary", arxiv_id=e.id) }}' class="arxiv-id-link" title="ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…, è¯¥ ID ä¹Ÿå¯ç”¨äºæœç´¢">{{ e.id }}</a>
        </div>
        <button class="abstract-pill-btn abstract-trigger" title="ç‚¹å‡»æŸ¥çœ‹è®ºæ–‡åŸå§‹æ‘˜è¦" data-arxiv-id="{{ e.id }}" data-abstract="{{ e.abstract or '' }}" data-english-title="{{ e.english_title or '' }}">
          <span class="pill-icon">ğŸ‘€</span>
          <span class="pill-text">Abstract</span>
        </button>
        {% if uid %}
          <button class="favorite-star-btn" title="{{ 'å·²æ„Ÿå…´è¶£ - ç‚¹å‡»å–æ¶ˆ' if e.is_favorited else 'æ„Ÿå…´è¶£è¿™ç¯‡è®ºæ–‡' }}" data-id="{{ e.id }}" data-favorited="{{ 'true' if e.is_favorited else 'false' }}">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="{{ '#fbbf24' if e.is_favorited else 'none' }}" stroke="currentColor" stroke-width="2">
              <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26 12,2"/>
            </svg>
          </button>
        {% endif %}
      </h2>
    </div>
    <div class="header-right">
      {% if e.submission_time %}
      <div class="update-time" title="arXivæäº¤æ—¥æœŸ">arXiv æäº¤æ—¥æœŸ: {{ e.submission_time.strftime('%Y-%m-%d') }}</div>
      {% endif %}
    </div>
  </div>
  <!-- Unified Tags Row - All tags in one scrollable line -->
  {% if e.recommendation or (e.top_tags and e.top_tags|length) or (e.detail_tags and e.detail_tags|length) %}
  <div class="tag-row unified-tags">
    {% set search_q = search_query or '' %}
    {% set tag_q = tag_query or '' %}
    {% set matched_tags = e.recommendation.matched_tags if e.recommendation and e.recommendation.matched_tags else [] %}
    
    {# Recommendation indicator #}
    {% if e.recommendation %}
      <span class="personalization-pill small">ğŸ¯ ä¸ºä½ æ¨è</span>
    {% endif %}
    
    {# Top tags (green) #}
    {% if e.top_tags and e.top_tags|length %}
      {% for tg in e.top_tags %}
        {% set is_matched = tg in matched_tags %}
        <a class="top-chip {% if search_q and (search_q.lower() in tg.lower()) %}search-hit{% elif tag_q and (tag_q in tg) %}query-hit{% elif is_matched %}match-hit{% endif %}" href='{{ url_for("index_page.index") }}?top={{ tg }}'>
          {% if is_matched %}âœ“ {% endif %}{{ tg }}
        </a>
      {% endfor %}
    {% endif %}
    
    {# Detail tags (blue) #}
    {% if e.detail_tags and e.detail_tags|length %}
      {% for tg in e.detail_tags[:12] %}
        {% set is_matched = tg in matched_tags %}
        <a class="tag-chip {% if search_q and (search_q.lower() in tg.lower()) %}search-hit{% elif tag_q and (tag_q in tg) %}query-hit{% elif is_matched %}match-hit{% endif %}" href='{{ url_for("index_page.index") }}?tag={{ tg }}'>
          {% if is_matched %}âœ“ {% endif %}{{ tg }}
        </a>
      {% endfor %}
      {% if e.detail_tags|length > 12 %}
        <span class="muted-chip">+{{ e.detail_tags|length - 12 }}</span>
      {% endif %}
    {% endif %}
  </div>
  {% endif %}
  
  <!-- Content Section -->
  <div class="content-section">
    <div class="summary-section">
      <div class='preview-html'>{{ e.preview_html | safe }}</div>
    </div>
  </div>
  
  <!-- Footer Section -->
  <div class='card-actions-container'>
    <!-- Priority 1: Core Decisions -->
    <div class="action-row primary-decisions">
      {% if show_read %}
        <a class='remove-read-link action-btn secondary-btn'>ä»æ²¡å…´è¶£åˆ—è¡¨ç§»é™¤</a>
      {% elif show_favorites %}
        <a class='remove-favorite-link action-btn secondary-btn'>ä»æ„Ÿå…´è¶£åˆ—è¡¨ç§»é™¤</a>
      {% elif show_todo %}
        <a class='remove-todo-link action-btn secondary-btn'>ä»å¾…è¯»ç§»é™¤</a>
        {% if uid %}
          <a class='mark-read-link action-btn secondary-btn'>ğŸ‘‹ æ²¡å…´è¶£</a>
        {% else %}
          <a class='mark-read-link action-btn secondary-btn disabled'>ğŸ‘‹ æ²¡å…´è¶£</a>
        {% endif %}
      {% else %}
        {% if uid %}
          <a class='mark-read-link action-btn secondary-btn'>ğŸ‘‹ æ²¡å…´è¶£</a>
        {% else %}
          <a class='mark-read-link action-btn secondary-btn disabled'>ğŸ‘‹ æ²¡å…´è¶£</a>
        {% endif %}
        {% if uid %}
          <a class='favorite-link action-btn secondary-btn' data-favorited='{{ 'true' if e.is_favorited else 'false' }}'>
            {% if e.is_favorited %}â­ å–æ¶ˆæ„Ÿå…´è¶£{% else %}â˜† æ„Ÿå…´è¶£{% endif %}
          </a>
        {% else %}
          <a class='favorite-link action-btn secondary-btn disabled'>â˜† æ„Ÿå…´è¶£</a>
        {% endif %}
      {% endif %}
    </div>

    <!-- Priority 2: Key Feature -->
    <div class="action-row main-feature">
      <button type="button" class='deep-read-link action-btn primary-btn' data-id='{{ e.id }}'>
        <svg class="ai-sparkle-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="color: white;">
          <path d="M12 3L14.5 9L21 11.5L14.5 14L12 21L9.5 14L3 11.5L9.5 9L12 3Z" fill="currentColor"/>
          <path d="M18 3L19.14 5.86L22 7L19.14 8.14L18 11L16.86 8.14L14 7L16.86 5.86L18 3Z" fill="currentColor" opacity="0.7"/>
        </svg> AI ç ”è¯»å…¨æ–‡
      </button>
    </div>

    <!-- Priority 3: Utilities -->
    <div class="action-row utilities">
      {% if not show_favorites and not show_todo and not show_read %}
        {% if uid %}
          <a class='add-todo-link action-btn secondary-btn'>ğŸ“Œ å¾…è¯»</a>
        {% else %}
          <a class='add-todo-link action-btn secondary-btn disabled'>ğŸ“Œ å¾…è¯»</a>
        {% endif %}
      {% endif %}
      <a target='_blank' href='https://arxiv.org/pdf/{{ e.id }}.pdf' class='action-btn secondary-btn'>
        <svg class="pdf-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 1.2em; height: 1.2em; vertical-align: middle; margin-right: 0.25rem;">
          <path d="M7 18H17V16H7V18Z" fill="currentColor" />
          <path d="M17 14H7V12H17V14Z" fill="currentColor" />
          <path d="M7 10H11V8H7V10Z" fill="currentColor" />
          <path d="M6 2C4.34315 2 3 3.34315 3 5V19C3 20.6569 4.34315 22 6 22H18C19.6569 22 21 20.6569 21 19V9L14 2H6ZM6 4H13V9H19V19C19 19.5523 18.5523 20 18 20H6C5.44772 20 5 19.5523 5 19V5C5 4.44772 5.44772 4 6 4Z" fill="currentColor" />
        </svg> PDF
      </a>
    </div>
  </div>
  
  <!-- Metadata Section -->
  {% if e.read_time or e.favorite_time or e.todo_time %}
  <div class='paper-metadata'>
    <div class='metadata-row'>
      {% if e.read_time %}
      <div class='metadata-item read'>
        <span class='metadata-icon'>ğŸ“–</span>
        <div class='metadata-content'>
          <span class='metadata-label'>æ²¡å…´è¶£</span>
          <span class='metadata-value'>{{ e.read_time[5:10] }} {{ e.read_time[11:16] }}</span>
        </div>
      </div>
      {% endif %}
      {% if e.favorite_time %}
      <div class='metadata-item favorite'>
        <span class='metadata-icon'>â­</span>
        <div class='metadata-content'>
          <span class='metadata-label'>æ„Ÿå…´è¶£</span>
          <span class='metadata-value'>{{ e.favorite_time[5:10] }} {{ e.favorite_time[11:16] }}</span>
        </div>
      </div>
      {% endif %}
      {% if e.todo_time %}
      <div class='metadata-item todo'>
        <span class='metadata-icon'>ğŸ“Œ</span>
        <div class='metadata-content'>
          <span class='metadata-label'>å¾…è¯»</span>
          <span class='metadata-value'>{{ e.todo_time[5:10] }} {{ e.todo_time[11:16] }}</span>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
  {% endif %}
</article>
