<!doctype html>
<html lang='en'>

<head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width,initial-scale=1'>
    <title>{{ arxiv_id }} â€“ Summary</title>
    <link rel="stylesheet" href="{{ url_for('base_css') }}">
    <link rel="stylesheet" href="{{ url_for('badge_css') }}">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="icon" href="/favicon.ico" sizes="any">
</head>

<body>
    <header style="display:flex;align-items:center;justify-content:space-between;gap:1rem;">
        <h1 style="margin:0;"><a href='{{ url_for("index") }}'>â† è¿”å›åˆ—è¡¨</a></h1>
        <div class="topbar-group">
          <span class="topbar-divider"></span>
          <button id="theme-toggle" class="topbar-btn icon-btn" type="button" aria-label="åˆ‡æ¢ä¸»é¢˜" title="åˆ‡æ¢åˆ°å¤œé—´æ¨¡å¼" data-icon-light="ğŸŒ™" data-icon-dark="â˜€ï¸">ğŸŒ™</button>
        </div>
    </header>
    <main>
        <div class="summary-header">
          <div class="source-info">
            {% if source_type == "user" %}
              <span class="badge user-badge" title="ç”¨æˆ·ä¸Šä¼ ">ğŸ‘¤ {{ user_id or "ç”¨æˆ·" }}</span>
              {% if original_url %}
                <span class="muted">æ¥æº: <a href="{{ original_url }}" target="_blank" class="source-link">{{ original_url }}</a></span>
              {% endif %}
            {% else %}
              <span class="badge system-badge" title="ç³»ç»Ÿè‡ªåŠ¨å¤„ç†">ğŸ¤– ç³»ç»Ÿè‡ªåŠ¨å¤„ç†</span>
            {% endif %}
          </div>
        </div>
        
        {% if tags and tags|length %}
        <form class="tag-row" method="GET" action="{{ url_for('index') }}" style="margin: .2rem 0 1rem; align-items:center; gap:.35rem;">
          {% for tg in tags %}
            <a class="tag-chip" href='{{ url_for("index") }}?tag={{ tg }}'>{{ tg }}</a>
          {% endfor %}
          <span class="muted" style="margin:0 .25rem 0 .5rem;">æˆ– æœç´¢:</span>
          <input type="text" name="q" placeholder="æ¨¡ç³Šæœç´¢æ ‡ç­¾" class="tag-input" />
          <button type="submit" class="topbar-btn">ç­›é€‰</button>
        </form>
        {% endif %}
        <article class='markdown-body'>
            {{ content | safe }}
        </article>
        <p style='text-align:center;margin-top:2rem;'>
            <a id='pdf-link' target='_blank' href='https://arxiv.org/pdf/{{ arxiv_id }}.pdf'>ğŸ“„ æ‰“å¼€åŸæ–‡ PDF</a>
        </p>
    </main>
    <script>
      // --- theme: init & toggle ---
      (function() {
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const saved = localStorage.getItem('theme');
        const theme = saved === 'dark' || saved === 'light' ? saved : (prefersDark ? 'dark' : 'light');
        const apply = (t) => {
          document.documentElement.setAttribute('data-theme', t === 'dark' ? 'dark' : 'light');
          const btn = document.getElementById('theme-toggle');
          if (btn) {
            const icon = t === 'dark' ? btn.getAttribute('data-icon-dark') : btn.getAttribute('data-icon-light');
            btn.textContent = icon || (t === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™');
            btn.setAttribute('title', t === 'dark' ? 'åˆ‡æ¢åˆ°æ—¥é—´æ¨¡å¼' : 'åˆ‡æ¢åˆ°å¤œé—´æ¨¡å¼');
            btn.setAttribute('aria-label', t === 'dark' ? 'åˆ‡æ¢åˆ°æ—¥é—´æ¨¡å¼' : 'åˆ‡æ¢åˆ°å¤œé—´æ¨¡å¼');
          }
        };
        apply(theme);
        document.addEventListener('DOMContentLoaded', () => apply(document.documentElement.getAttribute('data-theme') || theme));
        document.getElementById('theme-toggle')?.addEventListener('click', () => {
          const current = document.documentElement.getAttribute('data-theme') || 'light';
          const next = current === 'dark' ? 'light' : 'dark';
          localStorage.setItem('theme', next);
          apply(next);
        });
      })();

      // pdf click event (core)
      document.getElementById('pdf-link')?.addEventListener('click', (ev) => {
        const href = ev.currentTarget.getAttribute('href');
        const payload = {type:'open_pdf', arxiv_id: '{{ arxiv_id }}', meta:{href}, ts: new Date().toISOString(), tz_offset_min: new Date().getTimezoneOffset()};
        navigator.sendBeacon('/event', JSON.stringify(payload));
      });
    </script>
    <style>
      .tag-row { display: flex; flex-wrap: wrap; gap: .35rem; }
      .tag-chip {
        display: inline-flex; align-items: center; gap: .35rem;
        padding: .14rem .5rem; border-radius: 999px; font-size: .8rem;
        background: var(--action-bg); color: var(--action-text); text-decoration: none;
        border: 1px solid var(--btn-border);
      }
      .tag-input { padding: .25rem .5rem; border-radius: 6px; border: 1px solid var(--btn-border); background: var(--bg); color: var(--text); }
    </style>
</body>

</html>